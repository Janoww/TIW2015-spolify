<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <title>Modal Test Page</title>
    <link href="css/global.css" rel="stylesheet">
    <link href="css/components/modal.css" rel="stylesheet">
    <style>
        body {
            font-family: sans-serif;
            background-color: #D4BEE4;
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
        }
    </style>
</head>

<body>

    <!-- Reorder Playlist Modal -->
    <div class="modal" id="reorderModal" style="display:block; position:relative; margin-top: 50px;">
        <!-- display:block and relative for testing -->
        <!-- Removed modal-overlay for isolated testing, or it would cover the whole test page -->
        <div class="modal-content">
            <span class="close-button" id="closeReorderModal">&times;</span>
            <h2>Reorder Playlist: <span id="reorderPlaylistName">[Playlist Name Placeholder]</span></h2>
            <p class="modal-instructions">Drag and drop songs to reorder them.</p>
            <ul class="song-list-reorder" id="reorderSongList">
                <!-- Placeholder song items for visual testing -->
                <li class="reorder-song-item" data-song-id="song123" draggable="true">Song Title 1 - Artist A</li>
                <li class="reorder-song-item" data-song-id="song456" draggable="true">Song Title 2 - Artist B</li>
                <li class="reorder-song-item" data-song-id="song789" draggable="true">Song Title 3 - Artist C</li>
                <li class="reorder-song-item" data-song-id="song101" draggable="true">A Very Long Song Title That Might
                    Wrap Around To Test Text Handling - Artist D
                </li>
                <li class="reorder-song-item" data-song-id="song112" draggable="true">Another Song - Artist E</li>
            </ul>
            <div class="modal-actions">
                <button class="styled-button" id="saveOrderButton">Save Order</button>
                <button class="styled-button styled-button-secondary" id="cancelOrderButton">Cancel</button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const reorderSongList = document.getElementById('reorderSongList');
            let draggedItem = null;

            reorderSongList.addEventListener('dragstart', (event) => {
                if (event.target.classList.contains('reorder-song-item')) {
                    draggedItem = event.target;
                    let allItemsButOne = Array.from(document.querySelectorAll('.reorder-song-item'));
                    allItemsButOne = allItemsButOne.filter(item => item !== draggedItem);
                    allItemsButOne.forEach(item => item.classList.add('no-hover'));

                    event.dataTransfer.setData('text/plain', event.target.dataset.songId);
                    setTimeout(() => {
                        event.target.classList.add('dragging');
                    }, 0);
                }
            });

            reorderSongList.addEventListener('dragend', () => {
                if (draggedItem) {
                    const allItems = Array.from(document.querySelectorAll('.reorder-song-item'));
                    allItems.forEach(item => item.classList.remove('no-hover'));

                    draggedItem.classList.remove('dragging');
                    draggedItem = null;
                }
            });


            reorderSongList.addEventListener('dragover', (event) => {
                event.preventDefault();
                const targetItem = event.target.closest('.reorder-song-item');
                if (targetItem && targetItem !== draggedItem) {
                    const bounding = targetItem.getBoundingClientRect();
                    const offset = event.clientY - (bounding.top + bounding.height / 2);
                    const parent = reorderSongList;

                    if (offset > 0) {
                        parent.insertBefore(draggedItem, targetItem.nextSibling);
                    } else {
                        parent.insertBefore(draggedItem, targetItem);
                    }
                }
            });

            reorderSongList.addEventListener('drop', (event) => {
                event.preventDefault(); // Prevent default action (open as link for some elements)
                // The reordering is handled in dragover for immediate visual feedback.
                // If an item was being dragged, its 'dragging' class is removed in dragend.
            });

            // Add event listeners to initially present items if they are added dynamically later
            // For this static test page, the above listeners on the parent are sufficient.
        });
    </script>

</body>

</html>